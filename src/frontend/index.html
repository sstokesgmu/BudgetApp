<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles/styles.css">
</head>
<title>Budget App</title>
<body>
  <div class="card">
    <h1>Name</h1>
  <h2>Account: 123</h2>
  <h2 id="account_type">Account Type: <p style="display: inline-block; color:red"></p></h2>
  <h1 id="balance"></h2>
  <br>
  <br>
  <h2>Select An account</h2>
    <select id="accountSelect" style="width:300px">
    </select>
  <main>
    <button class="open-popup">Add a Transaction</button>
    <br>
    <br>
    <!-- <canvas></canvas> -->
  <h2>Transaction Table: Check most recent transactions</h2>
  <table>
    <thead>
    <tr>
      <th>Company</th>
      <th>Amount</th>
      <th>Date</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id = "table-body">
  </tbody>
  </table>
  </main>
  </div>
  <!-- Popup for Adding Transaction -->
 <!-- Popup with Form -->
 <div class="popup-overlay" id="popupOverlay">
  <div class="popup-card">
    <form>
      <h1>Enter Transaction Information</h1>

      <label for="company">Company</label>
      <input type="text" name="company" placeholder="What company was the transaction from" required>

      <label for="amount">Amount</label>
      <input type="number" name="amount" placeholder="Enter amount" required>

      <label for="account">Apply to Which Account</label>
      <select name="account" required>
        <option value="123">Account: 123</option>
        <option value="456">Account: 456</option>
        <option value="789">Account: 789</option>
      </select>

      <label for="type">Deposit or Withdrawal</label>
      <select name="type" required>
        <option value="deposit">Deposit</option>
        <option value="withdrawal">Withdrawal</option>
      </select>

      <button type="submit" class="btn">Submit</button>
      <button type="button" class="btn cancel">Cancel</button>
    </form>
  </div>
</div>

  <!-- JavaScript -->
  <script>
    // Popup functionality
    const openPopupButton = document.querySelector('.open-popup');
    const popupOverlay = document.getElementById('popupOverlay');
    const cancelButton = document.querySelector('.cancel'); // Update this to match the correct class
  
    // Open the popup
    openPopupButton.addEventListener('click', () => {
      popupOverlay.style.display = 'flex';
    });
  
    // Close the popup
    cancelButton.addEventListener('click', () => {
      popupOverlay.style.display = 'none';
    });
  
    // Close the popup when clicking outside the card
    popupOverlay.addEventListener('click', (e) => {
      if (e.target === popupOverlay) {
        popupOverlay.style.display = 'none';
      }
    });
  
    // Form submission handler
    const form = document.getElementsByTagName("form")[0];
    form.addEventListener("submit", async (event) => {
      event.preventDefault(); // Prevent the form from submitting normally
  
      // Collect form data
      const formData = {
        company: form.elements["company"].value,
        amount: form.elements["amount"].value,
        account: form.elements["account"].value,
        type: form.elements["type"].value,
      };
      console.log(formData); // Log form data for debugging
  
      // Send the form data to the server
      await fetch("/api/transactions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json", // Correct header for JSON
        },
        body: JSON.stringify(formData), // Send JSON string
      });

      // Trigger the "change" event on the dropdown
    if (accountSelect) {
      const changeEvent = new Event("change", { bubbles: true, cancelable: true });
      accountSelect.dispatchEvent(changeEvent);
    }

  
      // Close the popup after submission
      popupOverlay.style.display = 'none';
    });
  </script>
  
  <script src="scripts/index.js"></script>
</body>
</html>
